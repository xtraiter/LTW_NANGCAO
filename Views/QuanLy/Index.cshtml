@model CinemaManagement.ViewModels.DashboardViewModel

@{
    ViewData["Title"] = "Dashboard Qu·∫£n l√Ω";
}

<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2>
                    <i class="fas fa-tachometer-alt me-2"></i>
                    Dashboard Qu·∫£n l√Ω
                </h2>
                <div>
                    <a asp-action="ThongKeChiTiet" class="btn btn-info">
                        <i class="fas fa-chart-bar me-1"></i>
                        Th·ªëng k√™ chi ti·∫øt
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt me-2"></i>
                        Thao t√°c nhanh
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2">
                            <a asp-action="Index" asp-controller="PhatHanhVe" class="btn btn-primary btn-lg w-100 mb-2">
                                <i class="fas fa-plus-circle mb-1"></i><br>
                                Ph√°t h√†nh v√©
                            </a>
                        </div>
                        <div class="col-md-2">
                            <a asp-action="DanhSachVe" asp-controller="PhatHanhVe" class="btn btn-success btn-lg w-100 mb-2">
                                <i class="fas fa-list mb-1"></i><br>
                                Danh s√°ch v√©
                            </a>
                        </div>
                        <div class="col-md-2">
                            <a asp-action="ThongKe" asp-controller="PhatHanhVe" class="btn btn-info btn-lg w-100 mb-2">
                                <i class="fas fa-chart-bar mb-1"></i><br>
                                Th·ªëng k√™ v√©
                            </a>
                        </div>
                        <div class="col-md-2">
                            <a asp-action="QuanLyPhim" class="btn btn-warning btn-lg w-100 mb-2">
                                <i class="fas fa-film mb-1"></i><br>
                                Qu·∫£n l√Ω phim
                            </a>
                        </div>
                        <div class="col-md-2">
                            <a asp-action="QuanLyLichChieu" class="btn btn-secondary btn-lg w-100 mb-2">
                                <i class="fas fa-calendar-alt mb-1"></i><br>
                                L·ªãch chi·∫øu
                            </a>
                        </div>
                        <div class="col-md-2">
                            <a asp-action="BaoCao" class="btn btn-danger btn-lg w-100 mb-2">
                                <i class="fas fa-file-alt mb-1"></i><br>
                                B√°o c√°o
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- B·ªô l·ªçc th·ªëng k√™ -->
    <div class="row mb-4">
        <div class="col-md-12">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label for="tuNgay" class="form-label">T·ª´ ng√†y</label>
                    <input type="date" name="tuNgay" id="tuNgay" class="form-control" value="@Model.TuNgay?.ToString("yyyy-MM-dd")">
                </div>
                <div class="col-md-3">
                    <label for="denNgay" class="form-label">ƒê·∫øn ng√†y</label>
                    <input type="date" name="denNgay" id="denNgay" class="form-control" value="@Model.DenNgay?.ToString("yyyy-MM-dd")">
                </div>
                <div class="col-md-4">
                    <label for="tenPhim" class="form-label">T√™n phim</label>
                    <input type="text" name="tenPhim" id="tenPhim" class="form-control" placeholder="Nh·∫≠p t√™n phim..." value="@Model.TenPhim">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-filter me-1"></i> L·ªçc
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Th·ªëng k√™ t·ªïng quan -->
    <div class="row mb-4 mt-4">
        <div class="col-md-3">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <div class="display-4 fw-bold text-primary">@Model.TongSoVe</div>
                    <p class="card-text">T·ªïng s·ªë v√©</p>
                    <small class="text-muted">H√¥m nay: @Model.VeHomNay v√©</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-success">
                <div class="card-body text-center">
                    <div class="display-4 fw-bold text-success">@Model.DoanhThuThangNay.ToString("C0")</div>
                    <p class="card-text">Doanh thu th√°ng</p>
                    <small class="text-muted">H√¥m nay: @Model.DoanhThuHomNay.ToString("C0")</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-info">
                <div class="card-body text-center">
                    <div class="display-4 fw-bold text-info">@Model.TongSoPhim</div>
                    <p class="card-text">T·ªïng phim</p>
                    <small class="text-muted">ƒêang chi·∫øu: @Model.PhimDangChieu</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <div class="display-4 fw-bold text-warning">@Model.LichChieuHomNay</div>
                    <p class="card-text">L·ªãch chi·∫øu h√¥m nay</p>
                    <small class="text-muted">Tu·∫ßn n√†y: @Model.LichChieuTuanNay</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Bi·ªÉu ƒë·ªì doanh thu -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        Bi·ªÉu ƒë·ªì doanh thu 7 ng√†y g·∫ßn nh·∫•t
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="doanhThuChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>
                        Ph√¢n b·ªë tr·∫°ng th√°i v√©
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="trangThaiChart" width="400" height="400"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Top phim v√† l·ªãch chi·∫øu -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-trophy me-2"></i>
                        Top 5 phim b√°n ch·∫°y
                    </h5>
                </div>
                <div class="card-body">
                    @if (Model.TopPhimBanChay.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>H·∫°ng</th>
                                        <th>T√™n phim</th>
                                        <th>S·ªë v√©</th>
                                        <th>Doanh thu</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @for (int i = 0; i < Model.TopPhimBanChay.Count; i++)
                                    {
                                        var phim = Model.TopPhimBanChay[i];
                                        <tr>
                                            <td>
                                                @if (i == 0)
                                                {
                                                    <span class="badge bg-warning">ü•á</span>
                                                }
                                                else if (i == 1)
                                                {
                                                    <span class="badge bg-secondary">ü•à</span>
                                                }
                                                else if (i == 2)
                                                {
                                                    <span class="badge bg-info">ü•â</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-light text-dark">@(i + 1)</span>
                                                }
                                            </td>
                                            <td>@phim.TenPhim</td>
                                            <td><span class="badge bg-primary">@phim.SoVe</span></td>
                                            <td><span class="fw-bold text-success">@phim.DoanhThu.ToString("C0")</span></td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted text-center">Ch∆∞a c√≥ d·ªØ li·ªáu phim b√°n ch·∫°y.</p>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>
                        L·ªãch chi·∫øu g·∫ßn nh·∫•t
                    </h5>
                </div>
                <div class="card-body">
                    @if (Model.LichChieuGanNhat.Any())
                    {
                        @foreach (var lichChieu in Model.LichChieuGanNhat)
                        {
                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                                <div>
                                    <div class="fw-bold">@lichChieu.Phim?.TenPhim</div>
                                    <small class="text-muted">@lichChieu.PhongChieu?.TenPhong</small>
                                </div>
                                <div class="text-end">
                                    <div class="fw-bold">@lichChieu.ThoiGianBatDau.ToString("HH:mm")</div>
                                    <small class="text-muted">@lichChieu.ThoiGianBatDau.ToString("dd/MM")</small>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted text-center">Kh√¥ng c√≥ l·ªãch chi·∫øu s·∫Øp t·ªõi.</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Th·ªëng k√™ chi ti·∫øt -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">Th·ªëng k√™ v√©</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="fw-bold text-success">@Model.VeConHan</div>
                            <small class="text-muted">C√≤n h·∫°n</small>
                        </div>
                        <div class="col-4">
                            <div class="fw-bold text-info">@Model.VeDaBan</div>
                            <small class="text-muted">ƒê√£ s·ª≠ d·ª•ng</small>
                        </div>
                        <div class="col-4">
                            <div class="fw-bold text-danger">@Model.VeHetHan</div>
                            <small class="text-muted">H·∫øt h·∫°n</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">C∆° s·ªü h·∫° t·∫ßng</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="fw-bold text-primary">@Model.TongSoPhong</div>
                            <small class="text-muted">Ph√≤ng chi·∫øu</small>
                        </div>
                        <div class="col-6">
                            <div class="fw-bold text-info">@Model.TongSoGhe</div>
                            <small class="text-muted">Gh·∫ø ng·ªìi</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">Trung b√¨nh</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="fw-bold text-success">@(Model.TongSoVe > 0 ? (Model.DoanhThuThangNay / Model.VeThangNay).ToString("C0") : "0 ‚Ç´")</div>
                            <small class="text-muted">Gi√° v√© TB</small>
                        </div>
                        <div class="col-6">
                            <div class="fw-bold text-primary">@(Model.TongSoPhong > 0 ? (Model.TongSoGhe / Model.TongSoPhong) : 0)</div>
                            <small class="text-muted">Gh·∫ø/Ph√≤ng</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Bi·ªÉu ƒë·ªì doanh thu
        const doanhThuData = @Html.Raw(Json.Serialize(Model.DoanhThuTheoNgay));
        const doanhThuCtx = document.getElementById('doanhThuChart').getContext('2d');
        const doanhThuChart = new Chart(doanhThuCtx, {
            type: 'line',
            data: {
                labels: doanhThuData.map(d => new Date(d.ngay).toLocaleDateString('vi-VN')),
                datasets: [{
                    label: 'Doanh thu',
                    data: doanhThuData.map(d => d.doanhThu),
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString('vi-VN') + ' ‚Ç´';
                            }
                        }
                    }
                }
            }
        });

        // Bi·ªÉu ƒë·ªì tr·∫°ng th√°i v√©
        const trangThaiCtx = document.getElementById('trangThaiChart').getContext('2d');
        const trangThaiChart = new Chart(trangThaiCtx, {
            type: 'doughnut',
            data: {
                labels: ['C√≤n h·∫°n', 'ƒê√£ s·ª≠ d·ª•ng', 'H·∫øt h·∫°n'],
                datasets: [{
                    data: [@Model.VeConHan, @Model.VeDaBan, @Model.VeHetHan],
                    backgroundColor: [
                        '#28a745',
                        '#17a2b8',
                        '#dc3545'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    </script>
}

<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        transition: all 0.3s ease;
    }

    .card:hover {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }

    .btn-lg {
        padding: 1rem;
        font-size: 0.9rem;
    }

    .display-4 {
        font-size: 2.5rem;
    }

    @@media (max-width: 768px) {
        .display-4 {
            font-size: 2rem;
        }
    }
</style>
